buildscript {
    ext.kotlin_version = '1.2.31'
    repositories {
        jcenter() // Bintray's repository - a fast Maven Central mirror & more
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath 'com.google.cloud.tools:appengine-gradle-plugin:+'
        classpath 'org.jetbrains.dokka:dokka-gradle-plugin:+'
        classpath 'com.github.jengelman.gradle.plugins:shadow:+'
    }
}

apply plugin: 'com.github.johnrengelman.shadow'
apply plugin: 'java'
apply plugin: 'kotlin'
apply plugin: 'idea'
apply plugin: 'com.google.cloud.tools.appengine'
apply plugin: 'org.jetbrains.dokka'

group 'com.developersam.web'
version '4.0.0'

sourceCompatibility = 1.8  // App Engine Standard uses Java 8
targetCompatibility = 1.8  // App Engine Standard uses Java 8

compileKotlin {
    kotlinOptions {
        jvmTarget = '1.8'
    }
}
compileTestKotlin {
    kotlinOptions {
        jvmTarget = '1.8'
    }
}

repositories {
    maven {
        url 'https://maven-central.storage.googleapis.com'
        // Google's mirror of Maven Central
        maven { url 'https://jitpack.io' }
    }
    jcenter()
    mavenCentral()
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlin_version"
    testCompile("junit:junit:+")
    // Vert.x
    compile "io.vertx:vertx-core:+"
    compile "io.vertx:vertx-web:+"
    compile "io.vertx:vertx-lang-kotlin:+"
    // Google Cloud API
    compile 'com.google.cloud:google-cloud-datastore:+'
    compile 'com.google.cloud:google-cloud-language:+'
    // Add your dependencies here.
    // GSON, for parsing and generating JSON
    compile group: 'com.google.code.gson', name: 'gson', version: '2.8.2'
    compile group: 'org.danilopianini', name: 'gson-extras', version: '0.2.1'
    // Google's Java Library
    compile 'com.google.guava:guava:24.1-jre'
    // Logging
    compile 'org.slf4j:slf4j-api:+'
    compile 'org.slf4j:jcl-over-slf4j:+'
    compile 'org.slf4j:slf4j-log4j12:+'
    compile 'log4j:log4j:+'
    // TEN
    compile 'com.github.SamChou19815:TEN:1.0.2'
    // VertFireAuth
    compile 'com.github.SamChou19815:vert-fire-auth:0.1.0'
    // Vertx-GCP-Datastore
    compile 'com.github.SamChou19815:vertx-gcp-datastore:0.1.0'
}

shadowJar {
    baseName = "Developer-Sam-Website"
    version = 4.0
    manifest {
        attributes 'Main-Class': 'com.developersam.main.WebServer'
    }
}

project.tasks.assemble.dependsOn project.tasks.shadowJar

dokka {
    moduleName = 'Developer Sam Website'
    outputFormat = 'html'
    outputDirectory = "$buildDir/kdoc"
    jdkVersion = 8
    skipDeprecated = false
    skipEmptyPackages = true
    impliedPlatforms = ['JVM']
}

test {
    testLogging {
        events "passed", "skipped", "failed", "standardOut", "standardError"
    }
}

appengine {

    stage {
        artifact = "build/libs/Developer-Sam-Website-4.0-all.jar"
    }

    deploy {
        stopPreviousVersion = true
        promote = true
        version = 4
    }

}

